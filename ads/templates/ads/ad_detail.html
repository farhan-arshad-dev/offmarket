{% extends "base.html" %}
{% load static %}
{% block title %}{{ ad.title }} | Buy & Sell{% endblock %}
{% block content %}
  <div class="container my-4">
    <!-- Back link -->
    <div class="mb-3">
      <a href="{% url 'ads:ad_list' %}" class="text-decoration-none">‚Üê Back to Ads</a>
    </div>
    <div class="row g-4">
      <!-- Images Section -->
      <div class="col-md-6">
        {% if ad.images.exists %}
          <div id="adImageCarousel"
               class="carousel slide shadow-sm"
               data-bs-ride="carousel">
            <div class="carousel-inner">
              {% for img in ad.images.all %}
                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                  <img src="{{ img.image.url }}"
                       class="d-block w-100 rounded"
                       alt="{{ ad.title }}"
                       width="600"
                       height="400"
                       style="object-fit: cover">
                </div>
              {% endfor %}
            </div>
            {% if ad.images.count > 1 %}
              <button class="carousel-control-prev"
                      type="button"
                      data-bs-target="#adImageCarousel"
                      data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span>
              </button>
              <button class="carousel-control-next"
                      type="button"
                      data-bs-target="#adImageCarousel"
                      data-bs-slide="next">
                <span class="carousel-control-next-icon"></span>
              </button>
            {% endif %}
          </div>
        {% else %}
          <img src="{% static 'palceholders/ad-placeholder.png' %}"
               class="img-fluid rounded shadow-sm"
               alt="No image"
               width="600"
               height="400">
        {% endif %}
      </div>
      <!-- Details & User Info Section -->
      <div class="col-md-6">
        <div class="card shadow-sm h-100">
          <div class="card-body d-flex flex-column">
            <!-- Ad Details -->
            <h3 class="card-title mb-2">{{ ad.title }}</h3>
            <h4 class="text-success mb-3">{{ ad.price }} PKR</h4>
            <p class="text-muted small mb-3">Posted on {{ ad.created_at|date:"d M Y" }}</p>
            <hr>
            <h6>Description</h6>
            <p class="card-text">{{ ad.description|linebreaks }}</p>
            <hr>
            <!-- User Info -->
            <div class="mt-3 d-flex align-items-center">
              {% if ad.user.profile.avatar %}
                <img src="{{ ad.user.profile.avatar.url }}"
                     alt="{{ ad.user.full_name|default:ad.user.username }}"
                     class="rounded-circle me-3"
                     width="50"
                     height="50"
                     style="object-fit: cover">
              {% else %}
                <img src="{% static 'palceholders/profile-pic-placeholder.png' %}"
                     alt="User avatar"
                     class="rounded-circle me-3"
                     width="50"
                     height="50">
              {% endif %}
              <div>
                <h6 class="mb-0">{{ ad.user.full_name }}</h6>
                <small class="text-muted">{{ ad.user.email }}</small>
              </br>
              {% if user.is_authenticated and ad.show_phone_number and ad.user.profile.phone_number %}
                <small class="text-muted">{{ ad.user.profile.phone_number }}</small>
              {% endif %}
            </div>
          </div>
          {% if user.is_authenticated and user == ad.user %}
            <div class="mt-3 d-flex gap-2">
              <a href="{% url 'ads:ad_update' ad.pk %}"
                 class="btn btn-outline-primary btn-sm">Edit Ad Post</a>
              <a href="{% url 'ads:ad_delete' ad.pk %}"
                 class="btn btn-outline-danger btn-sm">Delete Ad Post</a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}
